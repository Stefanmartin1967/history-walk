import{E as d,s as g,a as y,b as C,c as D,l as b}from"./index-Bcyb-_R2.js";function h(a,o,e,t){let n=a+o/60+e/3600;return(t==="S"||t==="W")&&(n=n*-1),n}function S(a){return console.log("1. [DEBUG] Fonction getExifLocation appel√©e avec :",a.name),new Promise((o,e)=>{if(!d){console.error("2. [ERREUR] La librairie EXIF est undefined !"),e("Erreur technique : EXIF non charg√©");return}console.log("3. [DEBUG] Lancement de EXIF.getData...");try{d.getData(a,function(){console.log("4. [DEBUG] Callback EXIF d√©clench√© !"),console.log("5. [DEBUG] Contexte 'this' :",this);const t=d.getTag(this,"GPSLatitude");console.log("6. [DEBUG] Latitude brute trouv√©e :",t);const n=d.getTag(this,"GPSLatitudeRef"),r=d.getTag(this,"GPSLongitude"),i=d.getTag(this,"GPSLongitudeRef");if(t&&r&&n&&i){console.log("7. [DEBUG] Coordonn√©es compl√®tes trouv√©es ! Conversion...");const u=h(t[0],t[1],t[2],n),p=h(r[0],r[1],r[2],i);o({lat:u,lng:p})}else console.warn("8. [AVERTISSEMENT] Pas de tags GPS complets dans l'image."),e("Pas de donn√©es GPS trouv√©es dans cette photo.")})}catch(t){console.error("9. [CRASH] Erreur dans EXIF.getData :",t),e(t)}})}let l=null;const w=["Mosqu√©e","Site historique","Curiosit√©","H√¥tel","Restaurant","Caf√©","Taxi","Commerce"];function G(){}function M(a,o,e){l=L.marker([a,o],{draggable:!0,title:"D√©placez-moi pour ajuster"}).addTo(e);const t=document.createElement("div");t.style.textAlign="center",t.innerHTML=`
        <div style="font-weight:bold; margin-bottom:5px;">Nouveau Lieu ?</div>
        <div style="font-size:12px; color:#666; margin-bottom:8px;">Glissez pour ajuster.</div>
        <button id="btn-validate-desktop-poi" class="action-btn" style="background:var(--brand); color:white; padding:4px 8px; font-size:12px; cursor:pointer;">
            Valider cette position
        </button>
    `,l.bindPopup(t,{minWidth:200}).openPopup();const n=r=>{if(r.target&&r.target.id==="btn-validate-desktop-poi"){const i=l.getLatLng();k(i.lat,i.lng),e&&l&&e.removeLayer(l),l=null,document.body.removeEventListener("click",n)}};document.body.addEventListener("click",n),l.on("dragend",()=>l.openPopup())}async function F(a){console.log("üöÄ DesktopMode: R√©ception de",a.length,"fichiers."),Array.from(a).forEach(async o=>{try{console.log("üì∏ Traitement du fichier :",o.name);const e=await S(o);console.log("üìç GPS Trouv√© !",e),typeof addPhotoMarker=="function"?addPhotoMarker(e.lat,e.lng,o):typeof createPhotoMarker=="function"?createPhotoMarker(e.lat,e.lng,o):(console.log("‚ö†Ô∏è TODO: Appeler la fonction d'affichage ici avec :",e.lat,e.lng),alert(`Photo GPS trouv√©e !
Lat: ${e.lat}
Lng: ${e.lng}
(Manque la fonction d'affichage sur la carte)`))}catch(e){console.warn("‚ö†Ô∏è Pas de GPS pour",o.name,":",e)}})}function k(a,o){const e=document.getElementById("add-poi-modal");if(!e){console.error("Erreur: La modale 'add-poi-modal' est introuvable.");return}const t=document.getElementById("new-poi-coords"),n=document.getElementById("new-poi-name"),r=document.getElementById("new-poi-category"),i=document.getElementById("btn-confirm-add-poi"),u=document.getElementById("close-add-poi-modal");n.value="",t.textContent=`${a.toFixed(6)}, ${o.toFixed(6)}`,r.innerHTML="";const p=new Set(g.loadedFeatures.map(s=>s.properties.Cat√©gorie).filter(Boolean)),v=new Set([...w,...p]);Array.from(v).sort().forEach(s=>{const c=document.createElement("option");c.value=s,c.textContent=s,s==="Mosqu√©e"&&g.currentMapId?.includes("Djerba")&&(c.selected=!0),r.appendChild(c)}),e.style.display="flex",n.focus();const m=i.cloneNode(!0);i.parentNode.replaceChild(m,i),m.addEventListener("click",async()=>{const s=n.value.trim(),c=r.value;if(!s)return y("Nom requis","warning");const E=`HW-PC-${Date.now()}`;C({type:"Feature",geometry:{type:"Point",coordinates:[o,a]},properties:{"Nom du site FR":s,Cat√©gorie:c,Zone:"A d√©finir (PC)",Description:"Ajout√© depuis PC",HW_ID:E}}),await D("lastGeoJSON",{type:"FeatureCollection",features:g.loadedFeatures}),await b(E,"Cr√©ation PC","All",null,"Nouveau lieu PC"),y(`Lieu "${s}" ajout√© !`,"success"),e.style.display="none"});const P=()=>{e.style.display="none"},f=u.cloneNode(!0);u.parentNode.replaceChild(f,u),f.addEventListener("click",P)}export{M as createDraftMarker,G as enableDesktopCreationMode,F as handleDesktopPhotoImport,k as openDesktopAddModal};
