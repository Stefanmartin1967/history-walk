const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-ZDi-XX8j.js","assets/index-C-37ICqx.css"])))=>i.map(i=>d[i]);
import{g as x,s as m,m as u,_ as v,a as p}from"./index-ZDi-XX8j.js";const D=40;let i=null;const k=["MosquÃ©e","Site historique","CuriositÃ©","HÃ´tel","Restaurant","CafÃ©","Taxi","Commerce"];function S(){u&&u.on("contextmenu",n=>{const{lat:a,lng:t}=n.latlng;i?(i.setLatLng(n.latlng),i.openPopup()):C(a,t,u)})}function C(n,a,t){i&&i.remove(),i=L.marker([n,a],{draggable:!0,title:"DÃ©placez-moi pour ajuster"}).addTo(t);const e=document.createElement("div");e.style.textAlign="center",e.innerHTML=`
        <div style="font-weight:bold; margin-bottom:5px;">Nouveau Lieu ?</div>
        <div style="font-size:12px; color:#666; margin-bottom:8px;">Glissez pour ajuster.</div>
        <button id="btn-validate-desktop-poi" class="action-btn" style="background:var(--brand); color:white; padding:4px 8px; font-size:12px; cursor:pointer;">
            Valider cette position
        </button>
    `,i.bindPopup(e,{minWidth:200}).openPopup();const o=r=>{if(r.target&&r.target.id==="btn-validate-desktop-poi"){const l=i.getLatLng();F(l.lat,l.lng),t&&i&&t.removeLayer(i),i=null,document.body.removeEventListener("click",o)}};setTimeout(()=>{document.body.addEventListener("click",o)},100),i.on("dragend",()=>i.openPopup()),t.setView([n,a],t.getZoom())}async function I(n){console.log("ðŸš€ DesktopMode: RÃ©ception de",n.length,"fichiers.");let a=!1;for(const t of Array.from(n))try{console.log("ðŸ“¸ Analyse GPS :",t.name);const e=await x(t);console.log("ðŸ“ GPS TrouvÃ© :",e),a=!0;const o=A(e.lat,e.lng);o?(console.log("âœ… Lieu existant trouvÃ© :",o.properties["Nom du site FR"]),m(`Photo associÃ©e Ã  : ${o.properties["Nom du site FR"]}`,"success"),u.setView([e.lat,e.lng],18)):(console.log("ðŸ†• Aucun lieu connu. Lancement mode crÃ©ation."),m("Nouveau lieu dÃ©tectÃ© !","info"),C(e.lat,e.lng,u));break}catch{console.warn("âš ï¸ Pas de GPS pour",t.name)}a||m("Aucune donnÃ©e GPS trouvÃ©e dans les photos","warning")}function A(n,a){if(!p.loadedFeatures||p.loadedFeatures.length===0)return null;let t=null,e=1/0;return p.loadedFeatures.forEach(o=>{if(o.geometry&&o.geometry.type==="Point"){const[r,l]=o.geometry.coordinates,d=u.distance([n,a],[l,r]);d<e&&(e=d,t=o)}}),e<=D?t:null}function F(n,a){v(async()=>{const{addPoiFeature:t}=await import("./index-ZDi-XX8j.js").then(e=>e.b);return{addPoiFeature:t}},__vite__mapDeps([0,1])).then(({addPoiFeature:t})=>{v(async()=>{const{saveAppState:e}=await import("./index-ZDi-XX8j.js").then(o=>o.d);return{saveAppState:e}},__vite__mapDeps([0,1])).then(({saveAppState:e})=>{v(async()=>{const{logModification:o}=await import("./index-ZDi-XX8j.js").then(r=>r.l);return{logModification:o}},__vite__mapDeps([0,1])).then(({logModification:o})=>{const r=document.getElementById("add-poi-modal");if(!r)return;const l=document.getElementById("new-poi-coords"),d=document.getElementById("new-poi-name"),g=document.getElementById("new-poi-category"),f=document.getElementById("btn-confirm-add-poi"),y=document.getElementById("close-add-poi-modal");d.value="",l&&(l.textContent=`${n.toFixed(5)}, ${a.toFixed(5)}`),g.innerHTML="";const h=new Set(p.loadedFeatures.map(s=>s.properties.CatÃ©gorie).filter(Boolean)),_=new Set([...k,...h]);Array.from(_).sort().forEach(s=>{const c=document.createElement("option");c.value=s,c.textContent=s,s==="MosquÃ©e"&&p.currentMapId?.includes("Djerba")&&(c.selected=!0),g.appendChild(c)}),r.style.display="flex",d.focus();const E=f.cloneNode(!0);f.parentNode.replaceChild(E,f),E.addEventListener("click",async()=>{const s=d.value.trim(),c=g.value;if(!s)return m("Nom requis","warning");const w=`HW-PC-${Date.now()}`;t({type:"Feature",geometry:{type:"Point",coordinates:[a,n]},properties:{"Nom du site FR":s,CatÃ©gorie:c,Zone:"A dÃ©finir (PC)",Description:"AjoutÃ© depuis PC",HW_ID:w}}),await e("lastGeoJSON",{type:"FeatureCollection",features:p.loadedFeatures}),await o(w,"CrÃ©ation PC","All",null,"Nouveau lieu PC"),m(`Lieu "${s}" ajoutÃ© !`,"success"),r.style.display="none"});const b=()=>{r.style.display="none"},P=y.cloneNode(!0);y.parentNode.replaceChild(P,y),P.addEventListener("click",b)})})})}export{C as createDraftMarker,S as enableDesktopCreationMode,I as handleDesktopPhotoImport,F as openDesktopAddModal};
