<!DOCTYPE html>
<html lang="fr" data-theme="maritime">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>History Walk</title>
    <link rel="manifest" href="manifest.json">    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
    <script src="https://unpkg.com/lucide@0.395.0/dist/umd/lucide.min.js"></script>

  <script type="module" crossorigin src="/history-walk/assets/index-OlAXt3aZ.js"></script>
  <link rel="stylesheet" crossorigin href="/history-walk/assets/index-C-37ICqx.css">
</head>

<div id="backup-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; justify-content: center; align-items: center;">
    <div style="background: var(--surface, #fff); padding: 25px; border-radius: 12px; width: 90%; max-width: 400px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); text-align: center;">
        <h2 style="margin-top: 0; color: var(--ink, #333);">Sauvegarder</h2>
        <p style="color: var(--ink-light, #666); margin-bottom: 20px;">Choisissez le format de votre sauvegarde :</p>
        
        <button id="btn-backup-full" class="action-button" style="width: 100%; margin-bottom: 10px; background: var(--brand, #007bff); color: white; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
            <i data-lucide="image"></i> Complet (PC)
            <span style="font-size: 0.8em; opacity: 0.8; font-weight: normal;">‚Ä¢ Avec Photos</span>
        </button>

        <button id="btn-backup-lite" class="action-button" style="width: 100%; margin-bottom: 15px; background: var(--ok, #28a745); color: white; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
            <i data-lucide="file-text"></i> Texte Seul (Mobile)
            <span style="font-size: 0.8em; opacity: 0.8; font-weight: normal;">‚Ä¢ Rapide</span>
        </button>

        <button id="btn-backup-cancel" style="background: transparent; border: 1px solid var(--border, #ccc); color: var(--ink-light, #666); padding: 8px 20px; border-radius: 6px; cursor: pointer;">
            Annuler
        </button>
    </div>
</div>

<body>

    <div class="topbar">
        <div class="topbar-left">
            <h1 class="app-title" id="app-title">History Walk</h1>
        </div>
        <div class="topbar-center">
             <div class="search-container">
                <i data-lucide="search" class="search-icon"></i>
                <input type="search" id="search-input" placeholder="Rechercher un lieu...">
                <div class="search-results" id="search-results" style="display: none;"></div>
            </div>
        </div>
        <a href="fusion.html" target="_blank" class="btn" title="Ouvrir la Console de Fusion" style="text-decoration: none; display: flex; align-items: center; gap: 6px;">
        <i data-lucide="combine"></i><span>Fusion</span>
        </a>
        <div class="topbar-right">
            
            <button class="btn" id="btn-open-geojson" title="Ouvrir une carte"><i data-lucide="folder-open"></i><span>Ouvrir</span></button>
            <input type="file" id="geojson-loader" accept=".geojson,.json" style="display: none;">
            
            <button class="btn" id="btn-import-photos" title="Importation Photos GPS (PC)"><i data-lucide="camera"></i><span>Photos GPS</span></button>
            <input type="file" id="photo-gps-loader" accept=".jpg,.jpeg" multiple style="display: none;">

            <button class="btn" id="btn-save-mobile" title="Sauvegarde Mobile (Sans photos)" disabled><i data-lucide="save"></i><span>Mobile</span></button>
            
            <button class="btn" id="btn-save-full" title="Sauvegarde PC (Avec photos)" disabled><i data-lucide="save-all"></i><span>PC</span></button>

            <button class="btn" id="btn-restore-data" title="Restaurer une sauvegarde" disabled><i data-lucide="folder-down"></i><span>Restaurer</span></button>
            <input type="file" id="restore-loader" accept=".json" style="display: none;">

            <div class="separator"></div>

            <button class="btn" id="btn-mode-selection" title="Mode S√©lection (√âdition/Circuits)"><i data-lucide="mouse-pointer-click"></i><span>S√©lection</span></button>
            
            <button class="btn" id="btn-filter-mosquees" title="Masquer/Afficher les mosqu√©es"><i data-lucide="landmark"></i><span>Mosqu√©es</span></button>
            
            <button class="btn" id="btn-filter-vus" title="Masquer/Afficher les lieux visit√©s"><i data-lucide="eye"></i><span>Visit√©s</span></button>
            
            <button class="btn" id="btn-filter-planifies" title="Masquer/Afficher les planifi√©s"><i data-lucide="calendar-check"></i><span>Planifi√©s</span></button>
            
            <div class="zones-container">
                <button class="btn" id="btn-filter-zones" title="Filtre par Zone"><i data-lucide="map-pin"></i> <span id="zonesLabel">Zone</span></button>
                <div class="zones-menu" id="zonesMenu" style="display: none;"></div>
            </div>

            <button class="btn" id="btn-my-circuits" title="G√©rer mes circuits"><i data-lucide="route"></i><span>Circuits</span></button>

            <div class="separator"></div>

            <button class="btn" id="btn-export-pdf" title="Exporter en PDF (Bient√¥t)" disabled><i data-lucide="file-down"></i><span>PDF</span></button>
            
            <button class="btn" id="btn-theme-selector" title="Changer le th√®me"><i data-lucide="palette"></i><span>Th√®me</span></button>
        </div>
    </div>

    <div id="map"></div>
    <div id="app-version"></div>

    <div class="right-sidebar" id="right-sidebar" style="display: none;">
        <div class="sidebar-tabs" id="sidebar-tabs">
            <button class="tab-button active" data-tab="circuit">Circuit</button>
            <button class="tab-button" data-tab="details">D√©tails</button>
        </div>

        <div class="sidebar-panel active" id="circuit-panel" data-panel="circuit">
            <div class="panel-header circuit-header">
                <div class="circuit-title-container">
                    <h2 id="circuit-title-text" title="Nouveau Circuit">Nouveau Circuit</h2>
                </div>

                <div class="circuit-description-container">
                    <textarea id="circuit-description" rows="3" placeholder="Ajoutez une description pour votre circuit..."></textarea>
                </div>
                <div class="header-controls">
                    <div class="controls-group"></div>
                    <div class="controls-group meta-info">
                        <span id="circuit-poi-count">0/15</span>
                        <span>‚Ä¢</span>
                        <span id="circuit-distance">0.0 km</span>
                        <i id="distance-icon" data-lucide="bird" title="Distance √† vol d'oiseau"></i>
                    </div>
                    <div class="controls-group">
                        <button class="header-btn" id="close-circuit-panel-button" title="Fermer"><i data-lucide="x"></i></button>
                    </div>
                </div>
                <div class="transport-info">
                    <div class="transport-group">
                        <i data-lucide="log-out" title="Trajet Aller"></i>
                        <div class="transport-field">
                            <input type="number" id="transport-aller-temps" min="0" max="999" step="5" placeholder="0">
                            <span>min</span>
                        </div>
                        <div class="transport-field">
                             <input type="number" id="transport-aller-cout" min="0" max="999" placeholder="0">
                            <span>TND</span>
                        </div>
                    </div>
                    <div class="transport-group">
                        <i data-lucide="log-in" title="Trajet Retour"></i>
                        <div class="transport-field">
                            <input type="number" id="transport-retour-temps" min="0" max="999" step="5" placeholder="0">
                            <span>min</span>
                        </div>
                        <div class="transport-field">
                             <input type="number" id="transport-retour-cout" min="0" max="999" placeholder="0">
                            <span>TND</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="steps" id="circuit-steps-list">
                <p class="empty-list-info">Activez le mode s√©lection et cliquez sur la carte pour ajouter des points d'int√©r√™t.</p>
            </div>
            <div class="panel-footer">
                <button class="footer-btn pill" id="btn-loop-circuit"><i data-lucide="repeat"></i> <span>Boucler</span></button>
                <button class="footer-btn pill" id="btn-clear-circuit"><i data-lucide="trash-2"></i> <span>Vider</span></button>
                <button class="footer-btn pill" id="btn-import-gpx" disabled><i data-lucide="upload-cloud"></i> <span>Importer GPX</span></button>
                <button class="footer-btn pill" id="btn-export-gpx" disabled><i data-lucide="download-cloud"></i> <span>Export GPX</span></button>
            </div>
        </div>

        <div class="sidebar-panel" id="details-panel" data-panel="details">
            </div>
    </div>

    <div id="mobile-container">
        <main id="mobile-main-container"></main>
        
        <nav id="mobile-nav" class="mobile-nav">
            <button class="mobile-nav-btn" data-view="circuits">
                <i data-lucide="route"></i>
                <span>Circuits</span>
            </button>
    
            <button class="mobile-nav-btn" data-view="search">
                <i data-lucide="search"></i>
                <span>Rech.</span>
            </button>
    
            <button class="mobile-nav-btn" id="btn-mobile-filter">
            <i data-lucide="list"></i>
            <span>Filtre</span>
            </button>
    
            <button class="mobile-nav-btn" data-view="add-poi">
                <i data-lucide="plus-circle"></i>
                <span>Ajout</span>
            </button>
    
            <button class="mobile-nav-btn" data-view="actions">
                <i data-lucide="settings"></i>
                <span>Menu</span>
            </button>
        </nav>
    </div>

    <div id="circuits-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Mes Circuits</h2>
                <button id="close-circuits-modal" class="header-btn"><i data-lucide="x"></i></button>
            </div>
            <div id="circuits-list-container" class="modal-body">
            </div>
        </div>
    </div>

    <div id="add-poi-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 350px;">
            <div class="modal-header">
                <h2>Nouveau Lieu</h2>
                <button id="close-add-poi-modal" class="header-btn"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body" style="display: flex; flex-direction: column; gap: 15px; padding-top: 20px;">
                
                <div class="input-group" style="flex-direction: column; align-items: stretch; gap: 5px;">
                    <label for="new-poi-name" style="font-weight: 600;">Nom du lieu</label>
                    <input type="text" id="new-poi-name" class="editable-input" placeholder="Ex: Mosqu√©e du centre..." style="padding: 12px;">
                </div>

                <div class="input-group" style="flex-direction: column; align-items: stretch; gap: 5px;">
                    <label for="new-poi-category" style="font-weight: 600;">Cat√©gorie</label>
                    <select id="new-poi-category" class="editable-input" style="padding: 12px; background: var(--surface);">
                        </select>
                </div>

                <div style="font-size: 12px; color: var(--ink-soft); background: var(--surface-muted); padding: 8px; border-radius: 8px;">
                    üìç GPS : <span id="new-poi-coords">En attente...</span>
                </div>

                <button id="btn-confirm-add-poi" class="action-btn-large" style="margin-top: 10px;">
                    <i data-lucide="save"></i> Enregistrer
                </button>
            </div>
        </div>
    </div>

    <div id="fullscreen-editor" style="display: none;">
        <div class="editor-header">
            <h2 id="editor-title">√âditer</h2>
            <button id="editor-cancel-btn"><i data-lucide="arrow-left"></i> Annuler</button>
            <button id="editor-save-btn"><i data-lucide="check"></i> Sauvegarder</button>
        </div>
        <textarea id="editor-textarea"></textarea>
    </div>
    
    <input type="file" id="gpx-importer" accept=".gpx" style="display: none;">
    <input type="file" id="restore-loader" accept=".json" style="display: none;">
    <input type="file" id="destination-loader" style="display: none;"> <div id="loader-overlay" class="loader-overlay" style="display: none;">
        <div class="loader-spinner"></div>
    </div>
    <div id="toast-container" class="toast-container"></div>

    <div id="photo-viewer" class="photo-viewer" style="display: none;">
        <span class="close-viewer">√ó</span>
        <div class="viewer-nav nav-prev" id="viewer-prev">‚ùÆ</div>
        <img class="viewer-content" id="viewer-img">
        <div class="viewer-nav nav-next" id="viewer-next">‚ùØ</div>
    </div>

</body>
</html>